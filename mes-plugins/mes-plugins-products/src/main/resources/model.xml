<?xml version="1.0" encoding="UTF-8"?>
<qcd:models plugin="products" xmlns:qcd="http://www.qcadoo.com/model">
	<model name="product">
		<string name="number">
			<validatesPresence />
		</string>
		<text name="name">
			<validatesPresence />
		</text>
		<enum name="typeOfMaterial" values="product,intermediate,component">
			<validatesPresence />
		</enum>
		<string name="ean" />
		<dictionary name="category" dictionary="categories" />
		<string name="unit" />
		<hasMany name="substitutes" model="substitute" joinField="product" />
		<hasMany name="instructions" model="instruction" joinField="product" />
	</model>
	<model name="substitute">
		<string name="number">
			<validatesPresence />
		</string>
		<text name="name">
			<validatesPresence />
		</text>
		<datetime name="effectiveDateFrom" />
		<datetime name="effectiveDateTo" />
		<belongsTo name="product" model="product" lookupField="name" lazy="false">
			<validatesPresence /> 
		</belongsTo>
		<hasMany name="components" model="substituteComponent" joinField="substitute" />
		<priority name="priority" scope="product" />
		<validatesWith bean="com.qcadoo.mes.products.ProductService" method="checkSubstituteDates" message="products.validate.global.error.datesOrder" />
	</model>
	<model name="substituteComponent">
		<belongsTo name="product" model="product" lookupField="name">
			<validatesPresence /> 
		</belongsTo>
		<belongsTo name="substitute" model="substitute" lookupField="name">
			<validatesPresence /> 
		</belongsTo>
		<decimal name="quantity">
			<validatesPresence />
		</decimal>
	</model>
	<model name="instruction">
		<string name="number">
			<validatesPresence />
		</string>
		<text name="name">
			<validatesPresence />
		</text>
		<belongsTo name="product" model="product" lookupField="name" lazy="false">
			<validatesPresence /> 
		</belongsTo>
		<enum name="typeOfMaterial" values="product,intermediate,component">
			<validatesPresence />
		</enum>
		<boolean name="master" />
		<datetime name="dateFrom" />
		<datetime name="dateTo" />
		<text name="description" />
		<validatesWith bean="com.qcadoo.mes.products.ProductService" method="checkInstructionDefault" message="products.validate.global.error.default" />
		<validatesWith bean="com.qcadoo.mes.products.ProductService" method="checkInstructionDates" message="products.validate.global.error.datesOrder" />
	</model>
	<model name="order">
		<string name="number">
			<validatesPresence />
			<validatesUniqueness />
		</string>
		<text name="name">
			<validatesPresence />
		</text>
		<date name="dateFrom">
			<validatesPresence />
		</date>
		<date name="dateTo">
			<validatesPresence />
		</date>
		<enum name="state" values="pending,done">
			<validatesPresence />
		</enum>
		<enum name="machine" values="machine1,machine2" />
		<belongsTo name="product" model="product" lookupField="name" />
		<belongsTo name="defaultInstruction" model="instruction" lookupField="name" readonly="true" />
		<belongsTo name="instruction" model="instruction" lookupField="name" />
		<decimal name="plannedQuantity" />
		<decimal name="doneQuantity" />
		<date name="effectiveDateFrom" readonly="true" />
		<date name="effectiveDateTo" readonly="true" />
		<text name="startWorker" readonly="true" />
		<text name="endWorker" readonly="true" />
		<validatesWith bean="com.qcadoo.mes.products.ProductService" method="checkOrderDates" message="products.validate.global.error.datesOrder" />
		<onSave bean="com.qcadoo.mes.products.ProductService" method="fillOrderDatesAndWorkers" />
	</model>
</qcd:models>